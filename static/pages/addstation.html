<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</title>
    <link rel="icon" type="image/x-icon" href="/static/image/favicon.ico">
    <link rel="stylesheet" href="/static/css/style2.css">
</head>
<body>
    <div class="container">
        <a href="/" class="back-button">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</a>
        <div class="form-header">
            <h1>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h1>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</p>
        </div>

        <form id="stationForm" class="station-form" method="POST" action="/add-station">
            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ -->
            <div class="form-section">
                <h2><img src="/static/image/pin.png" alt="location icon" style="width: 30px;">&nbsp; ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="station">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ <span>*</span></label>
                        <input type="text" id="station" name="station" required>
                    </div>
                    <div class="form-group">
                        <label for="river">‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥ <span>*</span></label>
                        <input type="text" id="river" name="river" required>
                    </div>
                    <div class="form-group">
                        <label for="tambon">‡∏ï‡∏≥‡∏ö‡∏• <span>*</span></label>
                        <input type="text" id="tambon" name="tambon" required>
                    </div>
                    <div class="form-group">
                        <label for="amphoe">‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ <span>*</span></label>
                        <input type="text" id="amphoe" name="amphoe" required>
                    </div>
                    <div class="form-group">
                        <label for="province">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <span>*</span></label>
                        <input type="text" id="province" name="province" required>
                    </div>
                    <div class="form-group full-width">
                        <label for="location">‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á <span>*</span></label>
                        <textarea id="location" name="location" rows="3" required></textarea>
                    </div>
                </div>
            </div>

            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ô‡πâ‡∏≥ -->
            <div class="form-section">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2><img src="/static/image/water.png" alt="location icon" style="width: 30px;">&nbsp; ‡∏ú‡∏•‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ô‡πâ‡∏≥</h2>
                    <button type="button" class="btn-add-row" id="addWaterRowBtn">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                </div>
                <div class="table-wrapper">
                    <table class="water-table" id="waterTable">
                        <thead><tr></tr></thead>
                        <tbody id="waterTableBody"></tbody>
                    </table>
                </div>
                <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                    üí° ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                </p>
            </div>

            <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ï‡∏∞‡∏Å‡∏≠‡∏ô‡∏î‡∏¥‡∏ô -->
            <div class="form-section">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2><img src="/static/image/plant.png" alt="location icon" style="width: 30px;">&nbsp; ‡∏ú‡∏•‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ï‡∏∞‡∏Å‡∏≠‡∏ô‡∏î‡∏¥‡∏ô</h2>
                    <button type="button" class="btn-add-row" id="addSoilRowBtn">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                </div>
                <div class="table-wrapper">
                    <table class="soil-table" id="soilTable">
                        <thead><tr></tr></thead>
                        <tbody id="soilTableBody"></tbody>
                    </table>
                </div>
                <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                    üí° ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                </p>
            </div>

            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° -->
            <div class="form-actions">
                <button type="submit" class="btn-submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button type="reset" class="btn-reset" >‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
        </form>
    </div>

    <script>
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    const WATER_CHECK_COUNT = 14;
    const SOIL_CHECK_COUNT = 8;

    function createRow(type, checkCount, isFirstRow = false) {
    const row = document.createElement('tr');
    const isSoil = (type === 'soil');

    // ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à / ‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à
    const paramCell = document.createElement('td');
    const paramInput = document.createElement('input');
    paramInput.type = 'text';
    paramInput.name = isSoil ? 'soil_parameter[]' : 'parameter[]';
    paramInput.placeholder = isSoil ? '‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏∞‡∏Å‡∏±‡πà‡∏ß, ‡πÅ‡∏Ñ‡∏î‡πÄ‡∏°‡∏µ‡∏¢‡∏°' : '‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏∏‡πà‡∏ô, DO';
    paramInput.required = true;
    paramCell.appendChild(paramInput);
    row.appendChild(paramCell);

    // ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1 ‡∏ñ‡∏∂‡∏á checkCount
    for (let i = 1; i <= checkCount; i++) {
        const cell = document.createElement('td');
        const input = document.createElement('input');
        input.type = 'text';
        input.name = isSoil ? `soil_check${i}[]` : `check${i}[]`;
        cell.appendChild(input);
        row.appendChild(cell);
    }

    // ‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡πâ‡∏≥‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
    if (!isSoil) {
        const unitCell = document.createElement('td');
        const unitInput = document.createElement('input');
        unitInput.type = 'text';
        unitInput.name = 'unit[]';
        unitInput.placeholder = 'mg/L, NTU';
        unitInput.required = true;
        unitCell.appendChild(unitInput);
        row.appendChild(unitCell);
    }

    // ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞
    const actionCell = document.createElement('td');
    const trashIcon = document.createElement('img');
    trashIcon.src = '/static/image/delete.png';
    trashIcon.alt = '‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
    trashIcon.className = 'btn-remove-icon';
    trashIcon.style.width = '20px';
    trashIcon.style.cursor = 'pointer';

    if (isFirstRow) {
        trashIcon.style.opacity = '0.4';
        trashIcon.style.cursor = 'not-allowed';
    } else {
        trashIcon.addEventListener('click', () => {
            const tbodyId = isSoil ? 'soilTableBody' : 'waterTableBody';
            const tbody = document.getElementById(tbodyId);
            if (tbody.rows.length > 1) {
                row.remove();
            } else {
                alert(`‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (${isSoil ? '‡∏î‡∏¥‡∏ô' : '‡∏ô‡πâ‡∏≥'})`);
            }
        });
    }
    actionCell.appendChild(trashIcon);
    row.appendChild(actionCell);

    return row;
}

    function renderTableHeader(tableId, checkCount, firstColumnText, hasUnit = true) {
    const thead = document.querySelector(`#${tableId} thead tr`);
    thead.innerHTML = `<th>${firstColumnText}</th>`;
    for (let i = 1; i <= checkCount; i++) {
        const th = document.createElement('th');
        th.textContent = `‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${i}`;
        thead.appendChild(th);
    }
    if (hasUnit) {
        thead.innerHTML += '<th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>';
    }
    thead.innerHTML += '<th></th>'; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
}

    // === ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ===
    document.addEventListener('DOMContentLoaded', () => {
       // ‡∏ô‡πâ‡∏≥ (‡∏°‡∏µ‡∏´‡∏ô‡πà‡∏ß‡∏¢)
renderTableHeader('waterTable', WATER_CHECK_COUNT, '‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à', true);
const waterTbody = document.getElementById('waterTableBody');
waterTbody.appendChild(createRow('water', WATER_CHECK_COUNT, true));
document.getElementById('addWaterRowBtn').addEventListener('click', () => {
    waterTbody.appendChild(createRow('water', WATER_CHECK_COUNT, false));
});

// ‡∏î‡∏¥‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡πà‡∏ß‡∏¢)
renderTableHeader('soilTable', SOIL_CHECK_COUNT, '‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à', false); // ‡∏™‡πà‡∏á false
const soilTbody = document.getElementById('soilTableBody');
soilTbody.appendChild(createRow('soil', SOIL_CHECK_COUNT, true));
document.getElementById('addSoilRowBtn').addEventListener('click', () => {
    soilTbody.appendChild(createRow('soil', SOIL_CHECK_COUNT, false));
});
        // ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
    document.getElementById('stationForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(document.getElementById('stationForm'));
    
        try {
            const response = await fetch('/add-station', { // URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            if (result.success) {
                alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
                document.getElementById('stationForm').reset();
                resetTables();
            } else {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + (result.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'));
            }
        } catch (error) {
            console.error('Error:', error);
            alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ');
        }
    });

    function resetTables() {
        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡πâ‡∏≥
        const waterTbody = document.getElementById('waterTableBody');
        waterTbody.innerHTML = '';
        waterTbody.appendChild(createRow('water', WATER_CHECK_COUNT, true));

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏î‡∏¥‡∏ô
        const soilTbody = document.getElementById('soilTableBody');
        soilTbody.innerHTML = '';
        soilTbody.appendChild(createRow('soil', SOIL_CHECK_COUNT, true));
    }
    // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤)
    document.querySelector('.btn-reset').addEventListener('click', function(e) {
        e.preventDefault(); 
        location.reload(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    });
    });
    </script>
</body>
</html>